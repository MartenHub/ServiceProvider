# 🛡️ AuthenticationService

Bu proje, Go dilinde yazılmış, JWT tabanlı bir Authentication (kimlik doğrulama) servisidir. Mikroservis mimarisine uygun, temiz kod ve katmanlı yapıya sahiptir. PostgreSQL veritabanı kullanır, JWT ile token bazlı kimlik doğrulama sağlar.

---

## 🔧 Proje Yapısı ve Dosyalar

```bash
AuthenticationService/
├── api/                        # Swagger / OpenAPI dokümanları (opsiyonel)
├── cmd/
│   └── main.go                # Uygulama giriş noktaları
├── config/
│   └── config.go              # .env dosyasını okur, config struct'ını sağlar
├── Deployments/              # CI/CD, Kubernetes veya Docker Compose deployment manifest dosyaları
├── Dockerfile                # Uygulamanın Docker imajı için tanım
├── Docs/                     # Teknik dokümanlar ve geliştirme notları
├── go.mod / go.sum           # Go modül bağımlılıkları
├── internal/
│   ├── database/
│   │   ├── migrations.go     # Otomatik migration yönetimi (opsiyonel)
│   │   └── postgres.go       # Veritabanı bağlantısını sağlar
│   ├── handler/
│   │   ├── auth_handler.go   # HTTP endpoint fonksiyonları (Register, Login, Refresh)
│   │   ├── middleware.go     # JWT token doğrulayan middleware
│   │   └── router.go         # Route tanımları
│   ├── model/
│   │   ├── token.go          # RefreshToken struct'ı
│   │   └── user.go           # User struct, Register/Login request modelleri
│   ├── repository/
│   │   ├── user_repository.go   # User veri erişim arayüzü
│   │   └── token_repository.go  # Refresh token CRUD
│   ├── service/
│   │   ├── auth_service.go    # Register, login, refreshToken iş mantığı
│   │   └── token_service.go   # JWT token oluşturma/doğrulama
│   └── util/
│       ├── email.go          # Email gönderim işlemleri (opsiyonel)
│       ├── hash.go           # Bcrypt gibi hash fonksiyonları (opsiyonel)
│       └── jwt.go            # JWT utility fonksiyonları (opsiyonel)
├── migration/                 # SQL migration dosyaları (CLI ile kullanılır)
├── package.json               # (Vue/React frontend çalıştırılacaksa)
├── Revisions/                 # Feature branch veya özellik bazlı değişiklik takip dosyaları
```

---

## 📆 Yeni Dosya / Özellik Eklerken Ne Nereye Eklenir?

### ✅ Yeni HTTP Route Eklemek (/api/auth/...)

* `internal/handler/auth_handler.go` → yeni bir handler fonksiyonu yaz.
* `internal/handler/router.go` → route'u tanımla.
* `internal/service/auth_service.go` → iş mantığı gerekiyorsa burada yaz.

### 📊 Yeni DB Tablosu Eklemek

* `internal/model/` → yeni struct ekle.
* `internal/repository/` → bu modele ait veri erişim fonksiyonlarını tanımla.
* `migration/` ya da `database/migrations.go` → tabloyu oluşturacak SQL scriptini ekle.

### 🔑 Token Doğrulama / Middleware özelleştirmesi

* `internal/handler/middleware.go` dosyasından JWT'yi yakalayabilir, rol/yetki gibi claim'leri inceleyebilirsin.

### 📅 Arkaplanda Email/Hash/Util gibi fonksiyonlar

* `internal/util/` içine yeni dosya oluştur (regex, SMS, email, time helpers vb.)

### 📄 Config Değişiklikleri (.env)

* `.env` dosyasını değiştir.
* `config/config.go` dosyasınıda `os.Getenv()` ile yeni değişkeni çek.

---

## 🚀 Servisi Çalıştırmak

```bash
cp .env.example .env
nano .env       # veya code .env

go run ./cmd
```

---

## 🚫 Yetkilendirme Akışı

* `/api/auth/register` → yeni kullanıcı kaydı
* `/api/auth/login` → access + refresh token döner
* `/api/auth/refresh` → refresh token ile yeni token
* `/api/auth/me` → JWT token ile korumalı alan (middleware ile)

---

## ⚡ Geliştirme Tavsiyeleri

* Role-based middleware ekle: `admin`, `user` gibi
* Email doğrulama ve şifre sıfırlama fonksiyonlarını `service` + `handler` altına ekle
* Swagger/OpenAPI dosyasını `api/` altına koy ve belgelendir
* CI/CD için `Deployments/` altına GitHub Actions veya Docker Compose yaz

---

## 🚫 Docker (Hazırlık Aşaması)

* `Dockerfile` var ama image için:

  * `go build -o main ./cmd`
  * ENTRYPOINT veya CMD için `main`
* `docker-compose.yml` dosyası `Deployments/` altına eklenebilir.

---

## 🌐 API İletişim Biçimi

* Tüm istek/yanıtlar `application/json`
* JWT Bearer Token: `Authorization: Bearer <token>`

---

## 📁 Paket Yönetimi

* `go.mod` / `go.sum`: modül bağımlılıkları
* Yeni kütüphane eklemek için:

```bash
go get github.com/gin-gonic/gin
```

---

## ✅ Desteklenen Yetkinlikler

* [x] JWT Access ve Refresh Token
* [x] Bcrypt ile şifre saklama
* [x] Refresh Token DB kontrolü
* [x] Modülerle ayrılı test edilebilir kod yapısı
* [x] Middleware ile korumalı route
* [ ] Email doğrulama (hazırlanabilir)
* [ ] Rate Limit, Brute Force engeli (isteğe bağlı)

---



## 🔐 Endpointler (cURL Örnekleri)

### 📬 Register (Kayıt Ol)

```bash
curl -X POST http://localhost:8080/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "password": "123456"
}'
```

### 🔑 Login (Giriş Yap)

```bash
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "password": "123456"
}'
```

### 🔄 Refresh Token

```bash
curl -X POST http://localhost:8080/api/auth/refresh \
  -H "Authorization: Bearer <REFRESH_TOKEN>"
```

### 🛡️ Korumalı Endpoint Örneği

```bash
curl -X GET http://localhost:8080/api/protected \
  -H "Authorization: Bearer <ACCESS_TOKEN>"
```

> Not: `/api/protected` gibi örnek bir endpoint oluşturduğunuzda `middleware.go`'daki `AuthMiddleware` bunu korur.

---
