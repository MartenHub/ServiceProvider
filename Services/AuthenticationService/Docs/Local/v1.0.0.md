# ğŸ›¡ï¸ AuthenticationService

Bu proje, Go dilinde yazÄ±lmÄ±ÅŸ, JWT tabanlÄ± bir Authentication (kimlik doÄŸrulama) servisidir. Mikroservis mimarisine uygun, temiz kod ve katmanlÄ± yapÄ±ya sahiptir. PostgreSQL veritabanÄ± kullanÄ±r, JWT ile token bazlÄ± kimlik doÄŸrulama saÄŸlar.

---

## ğŸ”§ Proje YapÄ±sÄ± ve Dosyalar

```bash
AuthenticationService/
â”œâ”€â”€ api/                        # Swagger / OpenAPI dokÃ¼manlarÄ± (opsiyonel)
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ main.go                # Uygulama giriÅŸ noktalarÄ±
â”œâ”€â”€ config/
â”‚   â””â”€â”€ config.go              # .env dosyasÄ±nÄ± okur, config struct'Ä±nÄ± saÄŸlar
â”œâ”€â”€ Deployments/              # CI/CD, Kubernetes veya Docker Compose deployment manifest dosyalarÄ±
â”œâ”€â”€ Dockerfile                # UygulamanÄ±n Docker imajÄ± iÃ§in tanÄ±m
â”œâ”€â”€ Docs/                     # Teknik dokÃ¼manlar ve geliÅŸtirme notlarÄ±
â”œâ”€â”€ go.mod / go.sum           # Go modÃ¼l baÄŸÄ±mlÄ±lÄ±klarÄ±
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â”œâ”€â”€ migrations.go     # Otomatik migration yÃ¶netimi (opsiyonel)
â”‚   â”‚   â””â”€â”€ postgres.go       # VeritabanÄ± baÄŸlantÄ±sÄ±nÄ± saÄŸlar
â”‚   â”œâ”€â”€ handler/
â”‚   â”‚   â”œâ”€â”€ auth_handler.go   # HTTP endpoint fonksiyonlarÄ± (Register, Login, Refresh)
â”‚   â”‚   â”œâ”€â”€ middleware.go     # JWT token doÄŸrulayan middleware
â”‚   â”‚   â””â”€â”€ router.go         # Route tanÄ±mlarÄ±
â”‚   â”œâ”€â”€ model/
â”‚   â”‚   â”œâ”€â”€ token.go          # RefreshToken struct'Ä±
â”‚   â”‚   â””â”€â”€ user.go           # User struct, Register/Login request modelleri
â”‚   â”œâ”€â”€ repository/
â”‚   â”‚   â”œâ”€â”€ user_repository.go   # User veri eriÅŸim arayÃ¼zÃ¼
â”‚   â”‚   â””â”€â”€ token_repository.go  # Refresh token CRUD
â”‚   â”œâ”€â”€ service/
â”‚   â”‚   â”œâ”€â”€ auth_service.go    # Register, login, refreshToken iÅŸ mantÄ±ÄŸÄ±
â”‚   â”‚   â””â”€â”€ token_service.go   # JWT token oluÅŸturma/doÄŸrulama
â”‚   â””â”€â”€ util/
â”‚       â”œâ”€â”€ email.go          # Email gÃ¶nderim iÅŸlemleri (opsiyonel)
â”‚       â”œâ”€â”€ hash.go           # Bcrypt gibi hash fonksiyonlarÄ± (opsiyonel)
â”‚       â””â”€â”€ jwt.go            # JWT utility fonksiyonlarÄ± (opsiyonel)
â”œâ”€â”€ migration/                 # SQL migration dosyalarÄ± (CLI ile kullanÄ±lÄ±r)
â”œâ”€â”€ package.json               # (Vue/React frontend Ã§alÄ±ÅŸtÄ±rÄ±lacaksa)
â”œâ”€â”€ Revisions/                 # Feature branch veya Ã¶zellik bazlÄ± deÄŸiÅŸiklik takip dosyalarÄ±
```

---

## ğŸ“† Yeni Dosya / Ã–zellik Eklerken Ne Nereye Eklenir?

### âœ… Yeni HTTP Route Eklemek (/api/auth/...)

* `internal/handler/auth_handler.go` â†’ yeni bir handler fonksiyonu yaz.
* `internal/handler/router.go` â†’ route'u tanÄ±mla.
* `internal/service/auth_service.go` â†’ iÅŸ mantÄ±ÄŸÄ± gerekiyorsa burada yaz.

### ğŸ“Š Yeni DB Tablosu Eklemek

* `internal/model/` â†’ yeni struct ekle.
* `internal/repository/` â†’ bu modele ait veri eriÅŸim fonksiyonlarÄ±nÄ± tanÄ±mla.
* `migration/` ya da `database/migrations.go` â†’ tabloyu oluÅŸturacak SQL scriptini ekle.

### ğŸ”‘ Token DoÄŸrulama / Middleware Ã¶zelleÅŸtirmesi

* `internal/handler/middleware.go` dosyasÄ±ndan JWT'yi yakalayabilir, rol/yetki gibi claim'leri inceleyebilirsin.

### ğŸ“… Arkaplanda Email/Hash/Util gibi fonksiyonlar

* `internal/util/` iÃ§ine yeni dosya oluÅŸtur (regex, SMS, email, time helpers vb.)

### ğŸ“„ Config DeÄŸiÅŸiklikleri (.env)

* `.env` dosyasÄ±nÄ± deÄŸiÅŸtir.
* `config/config.go` dosyasÄ±nÄ±da `os.Getenv()` ile yeni deÄŸiÅŸkeni Ã§ek.

---

## ğŸš€ Servisi Ã‡alÄ±ÅŸtÄ±rmak

```bash
cp .env.example .env
nano .env       # veya code .env

go run ./cmd
```

---

## ğŸš« Yetkilendirme AkÄ±ÅŸÄ±

* `/api/auth/register` â†’ yeni kullanÄ±cÄ± kaydÄ±
* `/api/auth/login` â†’ access + refresh token dÃ¶ner
* `/api/auth/refresh` â†’ refresh token ile yeni token
* `/api/auth/me` â†’ JWT token ile korumalÄ± alan (middleware ile)

---

## âš¡ GeliÅŸtirme Tavsiyeleri

* Role-based middleware ekle: `admin`, `user` gibi
* Email doÄŸrulama ve ÅŸifre sÄ±fÄ±rlama fonksiyonlarÄ±nÄ± `service` + `handler` altÄ±na ekle
* Swagger/OpenAPI dosyasÄ±nÄ± `api/` altÄ±na koy ve belgelendir
* CI/CD iÃ§in `Deployments/` altÄ±na GitHub Actions veya Docker Compose yaz

---

## ğŸš« Docker (HazÄ±rlÄ±k AÅŸamasÄ±)

* `Dockerfile` var ama image iÃ§in:

  * `go build -o main ./cmd`
  * ENTRYPOINT veya CMD iÃ§in `main`
* `docker-compose.yml` dosyasÄ± `Deployments/` altÄ±na eklenebilir.

---

## ğŸŒ API Ä°letiÅŸim BiÃ§imi

* TÃ¼m istek/yanÄ±tlar `application/json`
* JWT Bearer Token: `Authorization: Bearer <token>`

---

## ğŸ“ Paket YÃ¶netimi

* `go.mod` / `go.sum`: modÃ¼l baÄŸÄ±mlÄ±lÄ±klarÄ±
* Yeni kÃ¼tÃ¼phane eklemek iÃ§in:

```bash
go get github.com/gin-gonic/gin
```

---

## âœ… Desteklenen Yetkinlikler

* [x] JWT Access ve Refresh Token
* [x] Bcrypt ile ÅŸifre saklama
* [x] Refresh Token DB kontrolÃ¼
* [x] ModÃ¼lerle ayrÄ±lÄ± test edilebilir kod yapÄ±sÄ±
* [x] Middleware ile korumalÄ± route
* [ ] Email doÄŸrulama (hazÄ±rlanabilir)
* [ ] Rate Limit, Brute Force engeli (isteÄŸe baÄŸlÄ±)

---



## ğŸ” Endpointler (cURL Ã–rnekleri)

### ğŸ“¬ Register (KayÄ±t Ol)

```bash
curl -X POST http://localhost:8080/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "password": "123456"
}'
```

### ğŸ”‘ Login (GiriÅŸ Yap)

```bash
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "password": "123456"
}'
```

### ğŸ”„ Refresh Token

```bash
curl -X POST http://localhost:8080/api/auth/refresh \
  -H "Authorization: Bearer <REFRESH_TOKEN>"
```

### ğŸ›¡ï¸ KorumalÄ± Endpoint Ã–rneÄŸi

```bash
curl -X GET http://localhost:8080/api/protected \
  -H "Authorization: Bearer <ACCESS_TOKEN>"
```

> Not: `/api/protected` gibi Ã¶rnek bir endpoint oluÅŸturduÄŸunuzda `middleware.go`'daki `AuthMiddleware` bunu korur.

---
